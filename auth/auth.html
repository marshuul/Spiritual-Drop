<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/index.css" />
    <link rel="stylesheet" href="./responsive.css" />
    <!-- favicon -->
    <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon" />
    <!-- fonts -->
    <link
      rel="preload"
      href="../assets/fonts/reddit/RedditSans-VariableFont_wght.ttf"
      as="font"
      type="font/ttf"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="../assets/fonts/KaliebLuxuryDemo-Regular.otf"
      as="font"
      type="font/otf"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="../assets/fonts/ImperialScript-Regular.ttf"
      as="font"
      type="font/ttf"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="../assets/fonts/Kapakana-VariableFont_wght.ttf"
      as="font"
      type="font/ttf"
      crossorigin="anonymous"
    />
    <link rel="preload" as="image" href="/assets/images/spirit-logo.png" />
    <!-- tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- title -->
    <title>Spiritual Drop | Recieve And Send</title>
  </head>
  <body>
    <main
      class="auth-main w-full min-h-screen flex flex-col md:flex-row items-center justify-between px-6 md:px-[100px] lg:px-[200px] py-10 md:py-[110px] transition-[padding] duration-150"
    >
      <div
        class="text-wrapper w-full md:w-1/2 h-full flex flex-col justify-between"
      >
        <div
          class="w-full flex-1 flex items-start justify-start md:justify-start"
        >
          <div class="header-wrapper w-full">
            <div
              class="header w-full h-full flex items-center md:justify-start justify-center"
            >
              <img
                src="../assets/images/spirit-logo.png"
                alt="spirit logo"
                class="w-12 h-12 md:w-[48px] md:h-[48px] mr-3 md:mr-[12px]"
              />
              <h1
                class="text-4xl md:text-[60px] text-[var(--primary)] font-[500]"
                style="font-family: var(--spirit-font)"
              >
                Welcome To Spirit
              </h1>
            </div>
            <div
              class="sub-title-wrapper w-full flex items-center md:items-start justify-center md:justify-start"
            >
              <p
                class="text-sm md:text-[15px] text-[var(--white)] font-[500] text-center md:text-left"
              >
                Login to your account, to start sending & receiving from
                Spiritual Drop
              </p>
            </div>
          </div>
        </div>
        <div
          class="footer w-full flex items-end justify-center md:justify-start"
        >
          <p class="text-xs md:text-[13px] text-[var(--white)] font-[500]">
            Created By Nabil Ben Mouina
          </p>
        </div>
      </div>
      <div
        class="providers-wrapper w-full md:w-1/2 h-full flex flex-col gap-3 md:gap-0 ml-[20px]"
      >
        <div
          class="providers-container w-full h-1/2 rounded-[30px] flex items-center justify-center p-[2px] mb-2 md:mb-[10px]"
          style="
            background: linear-gradient(
              220deg,
              var(--primary),
              var(--secondary-focus),
              var(--secondary-hover),
              var(--secondary-hover),
              var(--primary)
            );
          "
        >
          <div
            class="providers w-full h-full bg-[var(--solid)] rounded-[29px] flex items-center justify-center transition-[background] duration-150 hover:bg-[var(--solid-sec)] cursor-pointer"
          >
            <svg
              viewBox="0 0 20 20"
              preserveAspectRatio="xMidYMid meet"
              focusable="false"
              width="50px"
              height="50px"
              fill="none"
              class="md:w-[80px] md:h-[80px]"
            >
              <path
                d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"
                fill="var(--primary)"
              ></path>
              <path
                d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"
                fill="var(--primary)"
              ></path>
              <path
                d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"
                fill="var(--primary)"
              ></path>
              <path
                d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"
                fill="var(--primary)"
              ></path>
            </svg>
          </div>
        </div>
        <div
          class="providers-container w-full h-[calc(50%_-_10px)] rounded-[30px] flex items-center justify-center p-[2px]"
          style="
            background: linear-gradient(
              220deg,
              var(--primary),
              var(--secondary-focus),
              var(--secondary-hover),
              var(--secondary-hover),
              var(--primary)
            );
          "
        >
          <div
            class="providers w-full h-full bg-[var(--solid)] rounded-[29px] flex items-center justify-center transition-[background] duration-150 hover:bg-[var(--solid-sec)] cursor-pointer"
          >
            <svg
              id="github-icon"
              aria-hidden="true"
              viewBox="0 0 24 24"
              version="1.1"
              data-view-component="true"
              class="octicon octicon-mark-github v-align-middle"
              width="50px"
              height="50px"
              fill="none"
              class="md:w-[80px] md:h-[80px]"
            >
              <path
                d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"
                fill="var(--primary)"
              ></path>
            </svg>
          </div>
        </div>
      </div>
    </main>
    <script type="module">
      import { auth } from "../lib/firebase.js";
      import {
        signInWithPopup,
        GoogleAuthProvider,
        GithubAuthProvider,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { db } from "../lib/firebase.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // Get provider buttons
      const providerDivs = document.querySelectorAll(".providers");

      async function loginWithProvider(provider) {
        try {
          const result = await signInWithPopup(auth, provider);
          const user = result.user;
          // Fetch user info from Firestore
          const userDocRef = doc(db, "users", user.uid);
          const userDoc = await getDoc(userDocRef);
          let userData = {
            email: user.email,
            name: user.displayName,
            photo: user.photoURL,
            uid: user.uid,
          };
          if (userDoc.exists()) {
            userData = { ...userData, ...userDoc.data() };
          }
          // Store user context in localStorage
          localStorage.setItem("userContext", JSON.stringify(userData));
          // Redirect to home page
          window.location.href = "../index.html";
        } catch (error) {
          alert("Login failed: " + error.message);
        }
      }

      // First providers div is Google, second is GitHub
      providerDivs[0].addEventListener("click", () => {
        loginWithProvider(new GoogleAuthProvider());
      });
      providerDivs[1].addEventListener("click", () => {
        loginWithProvider(new GithubAuthProvider());
      });
    </script>
  </body>
</html>
